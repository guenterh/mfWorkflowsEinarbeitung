<?xml version="1.0" encoding="UTF-8"?>

<metamorph xmlns="http://www.culturegraph.org/metamorph" version="1">


    <macros>

        <macro name="viaf-literal">
            <entity name="$[abbrev]{}" flushWith="$[predicate]">
                <data source="$[predicate]" name="@value">
                    <regexp match='"(.*?)"' format="${1}"/>
                </data>
                <data source="$[predicate]" name="@language">
                    <regexp match='"@(.*)$' format="${1}"/>
                </data>
                <data source="$[predicate]" name="@type">
                    <regexp match='"\^\^.(.*).$' format="${1}"/>
                </data>
            </entity>
        </macro>

        <macro name="date-shortener">
            <choose>
                <data source="$[predicate]" name="$[abbrev]">
                    <regexp match='"\d\d\d\d"'/>
                </data>
                <data source="$[predicate]" name="$[abbrev]">
                    <regexp match='"(\d\d\d\d)-\d\d-\d\d"' format="${1}"/>
                </data>
            </choose>
        </macro>

        <macro name="person-literal">
            <data source="$[predicate]" name="$[abbrev]">
                <regexp match='"(.*)"|(.*)' format="${1}"/>
            </data>
        </macro>

        <macro name="language-tag">
            <entity name="$[abbrev]{}" flushWith="$[predicate]">
                <combine name="${lang}" value="${value}" flushWith="$[predicate]">
                    <data name="value" source="$[predicate]">
                        <regexp match='"(.*)"' format="${1}"/>
                    </data>
                    <data name="lang" source="$[predicate]">
                        <regexp match='.*"@(.*) *$' format="${1}"/>
                    </data>
                </combine>
            </entity>
        </macro>

    </macros>


    <rules>

        <data source="_id" name="\@id"/>
        <data source="_id" name="id">
            <replace pattern="http://viaf.org/viaf/" with=""/>
            <replace pattern="http://data.swissbib.ch/person/" with=""/>
        </data>

        <data source="_id" name="@type">
            <constant value="http://xmlns.com/foaf/0.1/Person"/>
        </data>

        <!--REFERENCED JSON-LD CONTEXT-->
        <data source="_id" name="@context">
            <constant value="http://data.swissbib.ch/person/context.jsonld"/>
        </data>

        <!-- VIAF resources -->
        <call-macro name="viaf-literal" abbrev="rdf:type" predicate="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"/>
        <call-macro name="viaf-literal" abbrev="schema:sameAs" predicate="http://schema.org/sameAs"/>
        <call-macro name="viaf-literal" abbrev="schema:name" predicate="http://schema.org/name"/>
        <call-macro name="viaf-literal" abbrev="rdf:value"
                    predicate="http://www.w3.org/1999/02/22-rdf-syntax-ns#value"/>
        <call-macro name="viaf-literal" abbrev="schema:gender" predicate="http://schema.org/gender"/>

        <call-macro name="date-shortener" abbrev="schema:birthDate" predicate="http://schema.org/birthDate"/>
        <call-macro name="date-shortener" abbrev="schema:deathDate" predicate="http://schema.org/deathDate"/>
        <call-macro name="date-shortener" abbrev="dbp:birthYear" predicate="http://dbpedia.org/ontology/birthYear"/>
        <call-macro name="date-shortener" abbrev="dbp:deathYear" predicate="http://dbpedia.org/ontology/deathYear"/>

        <!-- Person resources -->
        <call-macro name="person-literal" abbrev="skos:note" predicate="http://www.w3.org/2004/02/skos/core#note"/>
        <call-macro name="person-literal" abbrev="foaf:lastName" predicate="http://xmlns.com/foaf/0.1/lastName"/>
        <call-macro name="person-literal" abbrev="foaf:firstName" predicate="http://xmlns.com/foaf/0.1/firstName"/>
        <call-macro name="person-literal" abbrev="rdfs:label" predicate="http://www.w3.org/2000/01/rdf-schema#label"/>
        <call-macro name="person-literal" abbrev="foaf:name" predicate="http://xmlns.com/foaf/0.1/name"/>

        <call-macro name="language-tag" abbrev="dbp:abstract" predicate="http://dbpedia.org/ontology/abstract"/>
        <call-macro name="language-tag" abbrev="dbp:pseudonym" predicate="http://dbpedia.org/ontology/pseudonym"/>
        <call-macro name="language-tag" abbrev="dbp:alternativeNames"
                    predicate="http://dbpedia.org/ontology/alternativeNames"/>

        <data source="owl:sameAs" name="owl:sameAs"/>
        <data source="http://www.w3.org/2002/07/owl#sameAs" name="owl:sameAs"/>
        <data source="http://schema.org/alternateName" name="schema:alternateName"/>
        <data source="http://schema.org/description" name="schema:description"/>
        <data source="http://schema.org/givenName" name="schema:givenName"/>
        <data source="http://schema.org/familyName" name="schema:familyName"/>
        <data name="dbp:birthPlace" source="http://dbpedia.org/ontology/birthPlace"/>
        <data name="dbp:movement" source="http://dbpedia.org/ontology/movement"/>
        <data name="dbp:nationality" source="http://dbpedia.org/ontology/nationality"/>
        <data name="dbp:notableWork" source="http://dbpedia.org/ontology/notableWork"/>
        <data name="dbp:occupation" source="http://dbpedia.org/ontology/occupation"/>
        <data name="dbp:thumbnail" source="http://dbpedia.org/ontology/thumbnail"/>
        <data name="dbp:influencedBy" source="http://dbpedia.org/ontology/influencedBy"/>
        <data name="dbp:partner" source="http://dbpedia.org/ontology/partner"/>
        <data name="dbp:spouse" source="http://dbpedia.org/ontology/spouse"/>
        <data name="dbp:author" source="http://dbpedia.org/ontology/author"/>
        <data name="dbp:influenced" source="http://dbpedia.org/ontology/influenced"/>
        <data name="owl:differentFrom" source="http://www.w3.org/2002/07/owl#differentFrom"/>
        <data name="dc:identifier" source="http://purl.org/dc/terms/identifier"/>
    </rules>

</metamorph>
