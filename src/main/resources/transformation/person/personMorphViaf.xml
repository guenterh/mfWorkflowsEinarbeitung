<?xml version="1.0" encoding="UTF-8"?>

<metamorph xmlns="http://www.culturegraph.org/metamorph" version="1">

	<vars>
		<var name="swissbib_domain" value="http://data.swissbib.ch/resource/"/>
	</vars>

	<rules>


		<combine name="@key100" value="${firstname}##${lastname}##${number}##${title}##${lifedata}##${fullname}" flushWith="1001 ">
			<data source="1001 .a" name="firstname" />
			<data source="1001 .D" name="lastname" />
			<data source="1001 .b" name="number" />
			<data source="1001 .c" name="title" />
			<data source="1001 .d" name="lifedata" />
			<data source="1001 .q" name="fullname" />
			<postprocess>
				<java class="org.swissbib.linked.mf.morph.functions.AuthorHash"/>
			</postprocess>
		</combine>

		<combine name="@work" value="${t}" flushWith="245??">
			<data source="245??.a" name="t"/>
		</combine>

		<!--BUILD THE BASIS RECORD -->

		<entity name="foaf:Person" flushWith="record" >
			<data name="~rdf:about" source="@key100" >
				<compose prefix="http://data.swissbib.ch/person/" />
			</data>
			<combine name="rdfs:label" value="${firstname}${lastname}${developed}${dates}${note}" flushWith="1001 ">
				<data source="1001 .a" name="firstname" />
				<data source="1001 .D" name="lastname" >
					<compose prefix=", " />
				</data>
				<data source="1001 .q" name="developed" >
					<compose prefix=" (" postfix=")" />
				</data>
				<data source="1001 .d" name="dates" >
					<compose prefix=", " />
				</data>
				<data source="1001 .c" name="note" >
					<compose prefix=", " />
				</data>
			</combine>
			<data source="1001 .d" name="dbp:birthYear" >
				<regexp match="(\d\d\d\d).?[-]" format="${1}" />
			</data>
			<data source="1001 .d" name="dbp:deathYear" >
				<regexp match="(\d\d\d\d)$" format="${1}" />
			</data>
			<data source="1001 .a" name="foaf:lastName" />
			<data source="1001 .c" name="skos:note" />
			<data source="1001 .D" name="foaf:firstName" />
			
			<entity name="skos:closeMatch" >
				<combine name="~rdf:resource" value="${firstname}##${lastname}##${number}##${title}##${lifedata}##${fullname}##personname" flushWith="record" reset="true">
					<data source="1001 .a" name="lastname" />
					<data source="1001 .D" name="firstname" />
					<data source="1001 .b" name="number" />
					<data source="@work" name="title" />
					<data source="1001 .d" name="lifedata" />
					<data source="1001 .q" name="fullname" />
					<postprocess>
						<java class="org.swissbib.linked.mf.morph.functions.MatchViaf"/>
						<blacklist>
							<entry name=""/>
						</blacklist>
					</postprocess>
				</combine>
			</entity>
			
		</entity>
		
		




	</rules>

</metamorph>
